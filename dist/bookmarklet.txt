Zapiet Variant Audit â€” Bookmarklet

Two bookmarklet options are provided below. Use the first (plain) one by copying the entire line into a browser bookmark's URL field. If your browser rejects the plain version, use the URL-encoded variant (safer for some browsers).

Plain (single-line JS):
javascript:(function(){console.log("ðŸ” Loading Zapiet Audit Module...");const VARIANTS={"48739436265749":["Petite Strawberry Shortcake","Petite Strawberry Shortcake"],"48739453174037":["Petite Ube Custard","Petite Ube Custard"],"45317879300373":["Petite Choco Overload","Petite Choco Overload"],"45746820841749":["Banana Dream","Banana Dream"],"45317870780693":["Box of 12","Asado Roll (Pork)"],"46420646658325":["Box of 6","Asado Roll (Pork)"],"45317870747925":["Per Piece","Asado Roll (Pork)"],"45317870223637":["Box of 25","Mamonitos"],"45317878939925":["Regular Delivery","Ube Custard"],"45317878972693":["Mini Delivery","Ube Custard"],"45317879038229":["Regular Pickup","Strawberry Shortcake"],"45317879070997":["Mini Delivery","Strawberry Shortcake"],"49300964999445":["Ube","Burnt Basque Cheesecake"],"49300965032213":["Biscoff","Burnt Basque Cheesecake"],"49300965064981":["Strawberry","Burnt Basque Cheesecake"],"45317879726357":["Chocolate Blush","Chocolate Blush"],"46231334781205":["Family Size","Truffle Mushroom Linguine"],"46231334813973":["Party Size","Truffle Mushroom Linguine"],"45317875368213":["Family Size","Buttered Vegetables"],"45317875400981":["Party Size","Buttered Vegetables"],"45317874843925":["Family Size","Mango Royale Salad"],"45317874647317":["Family Size","Symphony Salad"],"45317875040533":["Family Size","Tofu Steak"],"45317875073301":["Party Size","Tofu Steak"],"45317877661973":["Family Size","Shanghai Rolls"],"45317877694741":["Party Size","Shanghai Rolls"],"45317872353557":["Family Size","Japanese Rice"],"45317872386325":["Party Size","Japanese Rice"],"45317872419093":["Family Size","Garlic Rice"],"45317872451861":["Party Size","Garlic Rice"],"45317876711701":["Family Size","Beef Caldereta"],"45317876744469":["Party Size","Beef Caldereta"],"45317874057493":["Family Size","Lasagna"],"45317874090261":["Party Size","Lasagna"],"45317874516245":["Family Size","Baked Mac"],"45317874549013":["Party Size","Baked Mac"],"45317873697045":["Family Size","Carbonara"],"45317873729813":["Party Size","Carbonara"],"45317872746773":["Family Size","Pancit Bam-I"],"45317872779541":["Party Size","Pancit Bam-I"],"45317872582933":["Family Size","Palabok"],"45317872615701":["Party Size","Palabok"],"45317872484629":["Family Size","Buttered Corn Rice"],"45317872517397":["Party Size","Buttered Corn Rice"],"46460520988949":["Family Size","Shanghai Bites"],"46460521021717":["Party Size","Shanghai Bites"],"49526281240853":["10 pax","Lasagna & Chicken"],"49526279012629":["10 pax","Bam-I & Shanghai"],"49526275277077":["10 pax","Sotanghon & Shanghai"],"49526280651029":["10 pax","Lasagna & Shanghai"],"49526279930133":["10 pax","Bam-I & Chicken"],"49526281437461":["10 pax","Jr Spaghetti & Shanghai"],"49526280126741":["10 pax","Pesto & Shanghai"],"49526281830677":["10 pax","Mac & Shanghai"],"49526281961749":["10 pax","Mac & Chicken"],"45317871763733":["10 pax","Bundle A"],"49273186353429":["30 pax","Bundle A"],"45317871862037":["50 pax","Bundle A"],"45317871108373":["10 pax","Bundle B"],"49273186451733":["30 pax","Bundle B"],"45317871173909":["50 pax","Bundle B"],"45317871010069":["10 pax","Bundle C"],"49273186877717":["30 pax","Bundle C"],"45317871075605":["50 pax","Bundle C"],"45317870911765":["10 pax","Bundle 1"],"49273186943253":["30 pax","Bundle 1"],"45317870977301":["50 pax","Bundle 1"],"48331350376725":["10 pax","Bundle 2"],"49273185206549":["30 pax","Bundle 2"],"48331350442261":["50 pax","Bundle 2"],"45317870813461":["10 pax","Bundle 3"],"49273185763605":["30 pax","Bundle 3"],"45317870878997":["50 pax","Bundle 3"]};function compress(list){if(!list||!list.length)return"none";const s=list.map(d=>new Date(d)).sort((a,b)=>a-b);const one=86400000;let out=[],st=s[0],p=s[0];const f=d=>d.toLocaleString("en",{month:"short",day:"2-digit"}).replace(" ","");for(let i=1;i<=s.length;i++){if(i<s.length&&s[i]-p===one){p=s[i];continue;}out.push(f(st)+(st.getTime()==p.getTime()?"":"-"+f(p)));st=s[i];p=s[i];}return out.join("; ");}const store=ZapietEats.getSelectedRestaurant();if(!store){alert("Select a store first.");return;}const pick={},deliv={};(store.menus||[]).forEach(m=>{(m.config?.store_pickup?.product_date_restrictions||[]).forEach(v=>pick[v.variant_id]=compress(v.restricted_dates));(m.config?.local_delivery?.product_date_restrictions||[]).forEach(v=>deliv[v.variant_id]=compress(v.restricted_dates));});const data=Object.keys(VARIANTS).map(id=>{const [v,p]=VARIANTS[id];const P=pick[id]||"none",D=deliv[id]||"none";return{id,variant:v,product:p,pick:P,del:D,miss:P=="none"&&D=="none"};});const missing=data.filter(r=>r.miss).length;const old=document.getElementById("zapiet-panel");if(old)old.remove();const box=document.createElement("div");box.id="zapiet-panel";box.style="position:fixed;top:20px;left:20px;right:20px;bottom:20px;background:#fff;border:2px solid #111;z-index:999999;padding:10px;overflow:auto;font-family:Arial";box.innerHTML=`<div style="display:flex;justify-content:space-between;"><div><b style="font-size:18px">Zapiet Variant Audit</b><br>Store: ${store.name}<br>Missing: <span style="color:red;font-weight:bold">${missing}</span> / ${data.length}</div><button onclick="document.getElementById('zapiet-panel').remove()">âœ• Close</button></div><br><input id="zapiet-search" placeholder="Searchâ€¦" style="padding:4px;width:230px"><button id="zapiet-csv" style="margin-left:8px;padding:4px">â¬‡ CSV</button><table id="zapiet-tbl" style="width:100%;border-collapse:collapse;margin-top:8px"><tr style="background:#eef"><th>Product</th><th>Variant</th><th>ID</th><th>Pickup</th><th>Delivery</th><th>Status</th></tr>${data.map(r=>`<tr class="r" style="background:${r.miss?"#ffd4d4":"white"}"><td>${r.product}</td><td>${r.variant}</td><td>${r.id}</td><td>${r.pick}</td><td>${r.del}</td><td style="color:${r.miss?"red":"green"}">${r.miss?"Missing":"OK"}</td></tr>`).join("")}</table>`;document.body.appendChild(box);document.getElementById("zapiet-search").oninput=e=>{const q=e.target.value.toLowerCase();document.querySelectorAll("#zapiet-tbl .r").forEach(r=>{r.style.display=r.innerText.toLowerCase().includes(q)?"":"none";});};document.getElementById("zapiet-csv").onclick=()=>{let csv="Product,Variant,ID,Pickup,Delivery,Status\n";document.querySelectorAll("#zapiet-tbl .r").forEach(r=>{if(r.style.display==="none")return;const t=[...r.children].map(td=>td.innerText.replace(/,/g," "));csv+=t.join(",")+"\n";});const a=document.createElement("a");a.href=URL.createObjectURL(new Blob([csv],{type:"text/csv"}));a.download=`zapiet-${store.id}.csv`;a.click();};})();

URL-encoded (if plain fails):
javascript:%28function%28%29%7Bconsole.log%28%22%F0%9F%94%8D%20Loading%20Zapiet%20Audit%20Module...%22%29%3Bconst%20VARIANTS%3D%7B...%7D%3B%2F* truncated for readability *%2F%7D%29%28%29%3B

Notes:
- To install: create a new bookmark in your browser, paste the entire single-line `javascript:` URL into the bookmark's URL field, then save.
- To run: open the Zapiet Eats admin/restaurant view where `ZapietEats.getSelectedRestaurant()` is available, then click the bookmark.
- If your browser blocks very long bookmark URLs, open the Developer Console and paste the contents of `dist/bookmarklet.js` and press Enter instead.

Files added:
- `dist/bookmarklet.js` â€” single-line minified IIFE (executable copy)
- `dist/bookmarklet.txt` â€” this file (human-friendly instructions + URLs)
